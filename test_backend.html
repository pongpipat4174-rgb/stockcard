<!DOCTYPE html>
<html>

<head>
    <title>Stock Card Backend Debugger</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        .group {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        label {
            display: block;
            margin-bottom: 5px;
        }

        input {
            padding: 5px;
            width: 100%;
            margin-bottom: 10px;
        }

        button {
            padding: 10px 20px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }

        button.delete {
            background: #dc3545;
        }

        #log {
            margin-top: 20px;
            padding: 10px;
            background: #f0f0f0;
            border: 1px solid #999;
            height: 300px;
            overflow-y: scroll;
            white-space: pre-wrap;
        }
    </style>
</head>

<body>
    <h1>Backend Debugger</h1>

    <div class="group">
        <h3>1. Test Connection (GET)</h3>
        <button onclick="testConnection()">Check Status</button>
    </div>

    <div class="group">
        <h3>2. Test Add Entry (POST)</h3>
        <button onclick="testAdd()">Add Test Entry</button>
    </div>

    <div class="group">
        <h3>3. Test Delete Entry (POST)</h3>
        <label>Row Index to Delete (Check Google Sheet):</label>
        <input type="number" id="rowIndex" placeholder="e.g. 50495">
        <button class="delete" onclick="testDelete()">Delete Row</button>
    </div>

    <div id="log">Logs will appear here...</div>

    <script>
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzdF61u0WhgQ6Uxmb_fCmfK8Ww1wlTMFBC79a13AFAhN2TCjBHKDL4VmVL49C4W5bKdVw/exec';

        async function testConnection() {
            log('Testing connection (GET)...');
            try {
                const res = await fetch(APPS_SCRIPT_URL);
                const data = await res.json();
                log('Success: ' + JSON.stringify(data));
            } catch (e) {
                log('Error: ' + e.message);
            }
        }

        async function testAdd() {
            log('Testing Add (POST)...');
            try {
                // NOTE: Using text/plain to avoid CORS preflight issues with simple requests, 
                // but Apps Script endpoint needs to handle it. 
                // However, standard fetch with JSON body usually triggers preflight.
                // Let's try standard way first.

                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' }, // Trick to avoid complex CORS
                    body: JSON.stringify({
                        action: 'add',
                        entry: {
                            date: new Date().toISOString().split('T')[0],
                            productCode: 'DEBUG-ADD',
                            productName: 'Debug Item',
                            remark: 'Added via Debugger'
                        }
                    })
                });

                const result = await response.json();
                log('Add Result: ' + JSON.stringify(result));
            } catch (e) {
                log('Add Error: ' + e.message);
            }
        }

        async function testDelete() {
            const rowIndex = document.getElementById('rowIndex').value;
            if (!rowIndex) { alert('Please enter row index'); return; }

            log(`Testing Delete Row ${rowIndex} (POST)...`);
            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    redirect: "follow",
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' }, // Trick to avoid complex CORS
                    body: JSON.stringify({
                        action: 'delete',
                        rowIndex: rowIndex
                    })
                });

                const result = await response.json();
                log('Delete Result: ' + JSON.stringify(result));
            } catch (e) {
                log('Delete Error: ' + e.message);
            }
        }

        function log(msg) {
            const div = document.getElementById('log');
            div.textContent += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
            div.scrollTop = div.scrollHeight;
        }
    </script>
</body>

</html>