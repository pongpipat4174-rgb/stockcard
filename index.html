<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Card Report - TAN PRODUCTION</title>
    <meta name="description" content="‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Stock Card ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö TAN PRODUCTION">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Sarabun:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Flatpickr Date Picker CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_green.css">
    <link rel="stylesheet" href="styles.css?v=24">
</head>

<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loader">
            <div class="loader-ring"></div>
            <div class="loader-ring"></div>
            <div class="loader-ring"></div>
            <span class="loader-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
        </div>
    </div>

    <!-- Header -->
    <header class="main-header">
        <div class="header-content">
            <div class="brand">
                <div class="brand-logo">
                    <img src="logo.png?v=2" alt="TAN PRODUCTION Logo">
                </div>
                <div class="brand-text">
                    <h1>Stock Card</h1>
                    <span>TAN PRODUCTION</span>
                </div>
            </div>

            <!-- Module Tabs Navigation -->
            <div class="module-tabs">
                <div class="tab-slider" id="tabSlider"></div>
                <button class="module-tab active" data-module="package" type="button" id="tabPackage">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                        <path
                            d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96" />
                        <line x1="12" y1="22.08" x2="12" y2="12" />
                    </svg>
                    üì¶ ‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à
                </button>
                <button class="module-tab" data-module="rm" type="button" id="tabRM">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" />
                        <line x1="3" y1="6" x2="21" y2="6" />
                        <path d="M16 10a4 4 0 0 1-8 0" />
                    </svg>
                    üß™ RM Center
                </button>
                <button class="module-tab" data-module="rm_production" type="button" id="tabRMProduction">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" />
                        <line x1="3" y1="6" x2="21" y2="6" />
                        <path d="M16 10a4 4 0 0 1-8 0" />
                    </svg>
                    üè≠ RM Production
                </button>
                <button class="module-tab" data-module="consumable" type="button" id="tabConsumable"
                    onclick="switchExternalModule('consumable')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                    </svg>
                    üß± ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏á
                </button>
                <button class="module-tab" data-module="general" type="button" id="tabGeneral"
                    onclick="switchExternalModule('general')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                        <path
                            d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" />
                    </svg>
                    ‚öôÔ∏è ‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà & ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
                </button>
            </div>

            <div class="header-actions">
                <button class="btn btn-success" id="addEntryBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19" />
                        <line x1="5" y1="12" x2="19" y2="12" />
                    </svg>
                    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                </button>
                <!-- Smart Withdraw Button (RM Only) -->
                <button class="btn btn-smart-withdraw" id="smartWithdrawBtn" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z" />
                        <path d="M2 17l10 5 10-5" />
                        <path d="M2 12l10 5 10-5" />
                    </svg>
                    üöÄ Smart ‡πÄ‡∏ö‡∏¥‡∏Å
                </button>
                <button class="btn btn-outline" id="refreshBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6M1 20v-6h6" />
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
                    </svg>
                    ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                <button class="btn btn-warning" id="recalculateBtn" style="display: none;"
                    title="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 4h16v16H4z" />
                        <path d="M9 9h6M9 12h6M9 15h3" />
                    </svg>
                    üîÑ Recalculate
                </button>
                <!-- Transfer to Production Button - REMOVED (auto-prompt is used instead) -->
                <button class="btn btn-primary" id="printAllBtn" onclick="printAll()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 6 2 18 2 18 9" />
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" />
                        <rect x="6" y="14" width="12" height="8" />
                    </svg>
                    ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
            </div>
        </div>
    </header>

    <!-- Module Iframes -->
    <div id="consumable-view-container" class="module-frame-container" style="display: none;">
        <iframe src="Consumable/index.html?v=mobile_fix_14" style="width: 100%; height: 100%; border: none;"></iframe>
    </div>

    <div id="general-view-container" class="module-frame-container" style="display: none;">
        <iframe src="GeneralStock/index.html?v=1" style="width: 100%; height: 100%; border: none;"></iframe>
    </div>

    <!-- StockCard Main Wrapper for Toggling -->
    <div id="stockcard-main-view">

        <!-- Module Title Banner -->
        <div class="module-banner" id="moduleBanner">
            <div class="module-banner-content">
                <span class="module-icon" id="moduleIcon">üì¶</span>
                <div class="module-info">
                    <h2 id="moduleTitle">Stock Card ‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à</h2>
                    <p id="moduleSubtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ö‡∏£‡∏£‡∏à‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÅ‡∏•‡∏∞‡πÅ‡∏û‡πá‡∏Ñ‡πÄ‡∏Å‡∏à</p>
                </div>
            </div>
        </div>

        <!-- Stats Dashboard -->
        <section class="stats-section">
            <div class="stats-grid">
                <div class="stat-card stat-primary clickable" onclick="showStatDetail('products')"
                    title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" />
                            <line x1="7" y1="7" x2="7.01" y2="7" />
                        </svg>
                    </div>
                    <div class="stat-content">
                        <span class="stat-value" id="totalProducts">0</span>
                        <span class="stat-label">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                    </div>
                    <div class="stat-arrow">‚Üí</div>
                </div>
                <div class="stat-card stat-success clickable" onclick="showStatDetail('in')"
                    title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
                        </svg>
                    </div>
                    <div class="stat-content">
                        <span class="stat-value" id="totalIn">0</span>
                        <span class="stat-label" id="labelTotalIn">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                    </div>
                    <div class="stat-arrow">‚Üí</div>
                </div>
                <div class="stat-card stat-warning clickable" onclick="showStatDetail('out')"
                    title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="1" y="3" width="15" height="13" />
                            <polygon points="16 8 20 8 23 11 23 16 16 16 16 8" />
                            <circle cx="5.5" cy="18.5" r="2.5" />
                            <circle cx="18.5" cy="18.5" r="2.5" />
                        </svg>
                    </div>
                    <div class="stat-content">
                        <span class="stat-value" id="totalOut">0</span>
                        <span class="stat-label" id="labelTotalOut">‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                    </div>
                    <div class="stat-arrow">‚Üí</div>
                </div>
                <div class="stat-card stat-info clickable" onclick="showStatDetail('all')"
                    title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                    <div class="stat-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="7" width="20" height="14" rx="2" ry="2" />
                            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
                        </svg>
                    </div>
                    <div class="stat-content">
                        <span class="stat-value" id="totalTransactions">0</span>
                        <span class="stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                    </div>
                    <div class="stat-arrow">‚Üí</div>
                </div>
            </div>
        </section>

        <!-- Expiry Alert Banners (RM Only) -->
        <section class="alert-banners-section" id="alertBannersSection" style="display: none;">
            <div class="alert-banners-container">
                <!-- Revalidated Alert (Purple) - Extended Items -->
                <div class="alert-banner alert-reval" id="alertReval" style="display: none;">
                    <div class="alert-banner-main" onclick="showExpiryItems('reval')">
                        <div class="alert-banner-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path
                                    d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2" />
                            </svg>
                        </div>
                        <div class="alert-banner-content">
                            <span class="alert-banner-title">üîÑ ‡∏™‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Å‡πà‡∏≠‡∏ô)</span>
                            <span class="alert-banner-count" id="revalCount">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                        </div>
                        <div class="alert-banner-arrow">‚Üí</div>
                    </div>
                    <!-- Print Reval Button -->
                    <button class="btn btn-print-alert btn-print-reval" onclick="printExpiryItems('reval')"
                        title="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏≠‡∏≤‡∏¢‡∏∏">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="24"
                            height="24">
                            <polyline points="6 9 6 2 18 2 18 9"></polyline>
                            <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                            <rect x="6" y="14" width="12" height="8"></rect>
                        </svg>
                    </button>
                </div>

                <!-- Critical Alert (Red) - Items expiring within 30 days -->
                <div class="alert-banner alert-critical" id="alertCritical">
                    <div class="alert-banner-main" onclick="showExpiryItems('critical')">
                        <div class="alert-banner-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path
                                    d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                                <line x1="12" y1="9" x2="12" y2="13" />
                                <line x1="12" y1="17" x2="12.01" y2="17" />
                            </svg>
                        </div>
                        <div class="alert-banner-content">
                            <span class="alert-banner-title">‚ö†Ô∏è ‡∏ß‡∏¥‡∏Å‡∏§‡∏ï! ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 30 ‡∏ß‡∏±‡∏ô</span>
                            <span class="alert-banner-count" id="criticalCount">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                        </div>
                        <div class="alert-banner-arrow">‚Üí</div>
                    </div>
                    <button class="btn btn-print-alert" onclick="printExpiryItems('critical')" title="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏Å‡∏§‡∏ï">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="24"
                            height="24">
                            <polyline points="6 9 6 2 18 2 18 9"></polyline>
                            <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                            <rect x="6" y="14" width="12" height="8"></rect>
                        </svg>
                    </button>
                </div>

                <!-- Warning Alert (Yellow) - Items expiring within 90 days -->
                <div class="alert-banner alert-warning-exp" id="alertWarning">
                    <div class="alert-banner-main" onclick="showExpiryItems('warning')">
                        <div class="alert-banner-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10" />
                                <polyline points="12 6 12 12 16 14" />
                            </svg>
                        </div>
                        <div class="alert-banner-content">
                            <span class="alert-banner-title">‚è∞ ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô! ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 90 ‡∏ß‡∏±‡∏ô</span>
                            <span class="alert-banner-count" id="warningCount">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                        </div>
                        <div class="alert-banner-arrow">‚Üí</div>
                    </div>
                    <button class="btn btn-print-alert btn-print-warning" onclick="printExpiryItems('warning')"
                        title="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="24"
                            height="24">
                            <polyline points="6 9 6 2 18 2 18 9"></polyline>
                            <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                            <rect x="6" y="14" width="12" height="8"></rect>
                        </svg>
                    </button>
                </div>

                <!-- Print All Expiry Button -->
                <button class="btn btn-print-all-expiry" onclick="printExpiryItems('all')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                        <polyline points="6 9 6 2 18 2 18 9"></polyline>
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                        <rect x="6" y="14" width="12" height="8"></rect>
                    </svg>
                    ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
            </div>
        </section>

        <!-- Filter Section -->
        <section class="filter-section">
            <div class="filter-container">
                <!-- Product/Supplier Dropdown (RM mode) -->
                <div class="rm-filter-group" id="rmFilterGroup" style="display: none;">
                    <label class="filter-label">üîç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:</label>
                    <select id="rmProductSelect" class="rm-product-select">
                        <option value="">-- ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>

                <div class="rm-filter-group" id="rmSupplierGroup" style="display: none;">
                    <label class="filter-label">üè≠ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Supplier:</label>
                    <select id="rmSupplierSelect" class="rm-product-select">
                        <option value="">-- ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>

                <!-- Date Filter -->
                <div class="date-filter-group">
                    <label class="filter-label">üìÖ ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
                    <input type="date" id="dateFilter" class="date-filter-input">
                </div>

                <!-- Search Box (for text search) -->
                <div class="search-wrapper">
                    <div class="search-box">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8" />
                            <path d="M21 21l-4.35-4.35" />
                        </svg>
                        <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ / ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ / Lot No..."
                            autocomplete="off">
                        <button class="clear-search" id="clearSearch" style="display: none;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18" />
                                <line x1="6" y1="6" x2="18" y2="18" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Clear Filter Button -->
                <button class="btn btn-clear-filter" id="clearFilterBtn" type="button">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                        <path d="M3 6h18" />
                        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                        <line x1="10" y1="11" x2="10" y2="17" />
                        <line x1="14" y1="11" x2="14" y2="17" />
                    </svg>
                    ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
                </button>

                <div class="selected-filter" id="selectedFilter" style="display: none;">
                    <span class="selected-label">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°:</span>
                    <span class="selected-value" id="selectedFilterValue"></span>
                    <button class="remove-filter" id="removeFilter">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18" />
                            <line x1="6" y1="6" x2="18" y2="18" />
                        </svg>
                    </button>
                </div>
            </div>
        </section>

        <!-- Stock Cards Container -->
        <main class="cards-container" id="cardsContainer">
            <!-- Stock cards will be dynamically generated -->
        </main>
    </div> <!-- End stockcard-main-view -->

    <!-- Print Preview Modal -->
    <div class="modal" id="printModal">
        <div class="modal-backdrop" id="modalBackdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå</h2>
                <button class="modal-close" id="modalClose">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="printPreview">
                <!-- Print preview content -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelPrint">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="btn btn-primary" id="confirmPrint">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 6 2 18 2 18 9" />
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" />
                        <rect x="6" y="14" width="12" height="8" />
                    </svg>
                    ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                </button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Entry Modal for Package -->
    <div class="modal" id="entryModal">
        <div class="modal-backdrop" id="entryModalBackdrop"></div>
        <div class="modal-content entry-modal-content">
            <div class="modal-header">
                <h2 id="entryModalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h2>
                <button class="modal-close" id="entryModalClose">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="entryForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="entryDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <span class="required">*</span></label>
                            <input type="date" id="entryDate" name="date" required>
                        </div>
                        <div class="form-group">
                            <label for="entryType">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ <span class="required">*</span></label>
                            <select id="entryType" name="type" required>
                                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
                                <option value="‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤</option>
                                <option value="‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï">‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï</option>
                                <option value="‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡∏à‡∏≤‡∏Å‡∏ú‡∏•‡∏¥‡∏ï">‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô‡∏à‡∏≤‡∏Å‡∏ú‡∏•‡∏¥‡∏ï</option>
                                <option value="‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡∏∑‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡∏∑‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</option>
                                <option value="‡πÄ‡∏ö‡∏¥‡∏Å(‡πÄ‡∏Ñ‡∏•‡∏°)">‡πÄ‡∏ö‡∏¥‡∏Å(‡πÄ‡∏Ñ‡∏•‡∏°)</option>
                                <option value="‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô(‡πÄ‡∏Ñ‡∏•‡∏°)">‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô(‡πÄ‡∏Ñ‡∏•‡∏°)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="entryProductCode">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ <span class="required">*</span></label>
                            <input type="text" id="entryProductCode" name="productCode" list="productCodeList" required
                                placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                            <datalist id="productCodeList">
                                <!-- Options will be populated dynamically -->
                            </datalist>
                        </div>
                        <div class="form-group">
                            <label for="entryProductName">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ <span class="required">*</span></label>
                            <input type="text" id="entryProductName" name="productName" required
                                placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                        </div>
                    </div>
                    <div class="form-grid form-grid-3">
                        <div class="form-group">
                            <label for="entryInQty">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ (IN)</label>
                            <input type="number" id="entryInQty" name="inQty" min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="entryOutQty">‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏≠‡∏Å (OUT)</label>
                            <input type="number" id="entryOutQty" name="outQty" min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="entryBalance">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (BALANCE)</label>
                            <input type="number" id="entryBalance" name="balance" placeholder="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥">
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="entryLotNo">Lot No./FIFO ID</label>
                            <input type="text" id="entryLotNo" name="lotNo" placeholder="‡πÄ‡∏ä‡πà‡∏ô PKT2511033">
                        </div>
                        <div class="form-group">
                            <label for="entryPkId">‡πÄ‡∏•‡∏Ç‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ (PK ID)</label>
                            <input type="text" id="entryPkId" name="pkId" placeholder="‡πÄ‡∏ä‡πà‡∏ô PK2601001">
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="entryDocRef">‡πÄ‡∏•‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á</label>
                            <input type="text" id="entryDocRef" name="docRef" placeholder="‡πÄ‡∏ä‡πà‡∏ô PDT-2511018/1">
                        </div>
                        <div class="form-group">
                            <label for="entryRemark">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                            <input type="text" id="entryRemark" name="remark" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelEntry">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="btn btn-success" id="saveEntry">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                        <polyline points="17 21 17 13 7 13 7 21" />
                        <polyline points="7 3 7 8 15 8" />
                    </svg>
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Entry Modal for RM -->
    <div class="modal" id="entryModalRM">
        <div class="modal-backdrop" id="entryModalBackdropRM"></div>
        <div class="modal-content entry-modal-content">
            <div class="modal-header modal-header-rm">
                <h2 id="entryModalTitleRM">üß™ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö (RM)</h2>
                <button class="modal-close" id="entryModalCloseRM">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="entryFormRM">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="entryDateRM">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <span class="required">*</span></label>
                            <input type="date" id="entryDateRM" name="date" required>
                        </div>
                        <div class="form-group">
                            <label for="entryTypeRM">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ <span class="required">*</span></label>
                            <select id="entryTypeRM" name="type" required>
                                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
                                <option value="‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤</option>
                                <option value="‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï">‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï</option>
                                <option value="‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï L12">‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï L12</option>
                                <option value="‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï L14">‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï L14</option>
                                <option value="‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï L8">‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï L8</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="entryProductCodeRM">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ <span class="required">*</span></label>
                            <input type="text" id="entryProductCodeRM" name="productCode" list="productCodeListRM"
                                required placeholder="‡πÄ‡∏ä‡πà‡∏ô LIW-R-023-AMP" autocomplete="off">
                            <datalist id="productCodeListRM">
                                <!-- Options will be populated dynamically -->
                            </datalist>
                        </div>
                        <div class="form-group">
                            <label for="entryProductNameRM">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ <span class="required">*</span></label>
                            <input type="text" id="entryProductNameRM" name="productName" required
                                placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö">
                        </div>
                    </div>
                    <div class="form-grid" id="containerInputRow" style="display: none;">
                        <div class="form-group">
                            <label for="entryContainerQtyRM">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Container <span style="color:red;">*</span></label>
                            <input type="number" id="entryContainerQtyRM" name="containerQty" min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="entryContainerWeightRM">‡∏ô‡∏ô. Container (Kg) <span
                                    style="color:red;">*</span></label>
                            <input type="number" id="entryContainerWeightRM" name="containerWeight" min="0" step="0.01"
                                placeholder="0">
                        </div>
                    </div>
                    <!-- Hidden remainder field -->
                    <input type="hidden" id="entryRemainderRM" name="remainder" value="0">
                    <!-- Out Qty and Container Out Row -->
                    <div class="form-grid" id="outQtyContainerRow" style="display: none;">
                        <div class="form-group" id="outQtyGroup">
                            <label for="entryOutQtyRM">‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏≠‡∏Å (Kg)</label>
                            <input type="number" id="entryOutQtyRM" name="outQty" min="0" step="0.01"
                                placeholder="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥">
                        </div>
                        <div class="form-group" id="containerOutGroup">
                            <label for="entryContainerOutRM">‡∏†‡∏≤‡∏ä‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å (‡πÉ‡∏ö) <span style="color:red;">*</span></label>
                            <input type="number" id="entryContainerOutRM" name="containerOut" step="1" min="0"
                                placeholder="0" value="0">
                        </div>
                        <div class="form-group" id="containerWeightOutGroup">
                            <label for="entryContainerWeightOutRM">‡∏ô.‡∏ô./‡∏†‡∏≤‡∏ä‡∏ô‡∏∞ (Kg) <span
                                    style="color:red;">*</span></label>
                            <input type="number" id="entryContainerWeightOutRM" name="containerWeightOut" step="0.01"
                                min="0" placeholder="‡πÄ‡∏ä‡πà‡∏ô 20">
                        </div>
                    </div>
                    <!-- In Qty Row (for receive) -->
                    <div id="inQtyBalanceRow" style="display: none;">
                        <div class="form-group" id="inQtyGroup">
                            <label for="entryInQtyRM">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ (Kg) <span style="color:red;">*</span></label>
                            <input type="number" id="entryInQtyRM" name="inQty" min="0" step="0.01" placeholder="0">
                        </div>
                    </div>
                    <!-- Balance Row (for withdrawal) -->
                    <div class="form-grid" id="balanceRow" style="display: none;">
                        <div class="form-group" id="balanceGroup">
                            <label for="entryBalanceRM">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏ö‡∏¥‡∏Å (Kg)</label>
                            <input type="number" id="entryBalanceRM" name="balance" step="0.01"
                                placeholder="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥" readonly>
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="entryLotNoRM">Lot No./FIFO ID <span style="color:red;">*</span></label>
                            <input type="text" id="entryLotNoRM" name="lotNo" placeholder="‡πÄ‡∏ä‡πà‡∏ô RM2511033">
                        </div>
                        <div class="form-group">
                            <label for="entryVendorRM">‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á/Vendor <span style="color:red;">*</span></label>
                            <input type="text" id="entryVendorRM" name="vendor" placeholder="‡πÄ‡∏ä‡πà‡∏ô CHEMICO">
                        </div>
                    </div>
                    <div class="form-grid" id="mfdExpRow" style="display: none;">
                        <div class="form-group">
                            <label for="entryVendorLotRM">Vendor Lot</label>
                            <input type="text" id="entryVendorLotRM" name="vendorLot" placeholder="Lot ‡∏à‡∏≤‡∏Å Supplier">
                        </div>
                        <div class="form-group">
                            <label for="entryMfgDateRM">‡∏ß‡∏±‡∏ô‡∏ú‡∏•‡∏¥‡∏ï (MFD) <span style="color:red;">*</span></label>
                            <input type="date" id="entryMfgDateRM" name="mfgDate">
                        </div>
                        <div class="form-group">
                            <label for="entryExpDateRM">‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ (EXP) <span style="color:red;">*</span></label>
                            <input type="date" id="entryExpDateRM" name="expDate">
                        </div>
                    </div>
                    <!-- Warning Section for Split Lots -->
                    <div id="lotSplitWarning"
                        style="display:none; background:#fff3cd; color:#856404; padding:10px; border-radius:5px; margin-top:10px; font-size:0.9em; border: 1px solid #ffeeba;">
                        <strong>‚ö†Ô∏è ‡∏¢‡∏≠‡∏î‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô Lot ‡∏ô‡∏µ‡πâ!</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏¢‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:
                        <ul id="lotSplitList" style="margin:5px 0 0 20px; padding:0;"></ul>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" id="clearFormRM" type="button" style="margin-right: auto;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        style="width:16px;height:16px;">
                        <path
                            d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                    </svg>
                    ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                <button class="btn btn-outline" id="cancelEntryRM">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="btn btn-success" id="saveEntryRM">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                        <polyline points="17 21 17 13 7 13 7 21" />
                        <polyline points="7 3 7 8 15 8" />
                    </svg>
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
        </div>
    </div>

    <!-- Smart Withdraw Modal -->
    <div class="modal" id="smartWithdrawModal">
        <div class="modal-backdrop" id="smartWithdrawBackdrop"></div>
        <div class="modal-content smart-withdraw-modal-content">
            <div class="modal-header modal-header-smart-withdraw">
                <h2>üöÄ Smart Withdrawal (FEFO/FIFO)</h2>
                <button class="modal-close" id="smartWithdrawModalClose">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <!-- Step 1: Input Section -->
                <div class="smart-withdraw-step" id="smartWithdrawStep1">
                    <h3 class="step-title">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å</h3>
                    <form id="smartWithdrawForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="swProductSelect">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö (RM) <span class="required">*</span></label>
                                <select id="swProductSelect" class="smart-withdraw-select" required>
                                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ --</option>
                                    <!-- Options will be populated dynamically -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="swProductName">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                                <input type="text" id="swProductName" readonly placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥">
                            </div>
                        </div>
                        <div class="form-grid form-grid-3">
                            <div class="form-group">
                                <label for="swTotalQty">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å (Kg) <span class="required">*</span></label>
                                <input type="number" id="swTotalQty" min="0.01" step="0.01" placeholder="‡πÄ‡∏ä‡πà‡∏ô 100"
                                    required>
                            </div>
                            <div class="form-group">
                                <label for="swJobCategory">Job Category / ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</label>
                                <select id="swJobCategory">
                                    <option value="‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï">‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï</option>
                                    <option value="‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï L12">‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï L12</option>
                                    <option value="‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï L14">‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï L14</option>
                                    <option value="‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï L8">‡πÄ‡∏ö‡∏¥‡∏Å‡∏ú‡∏•‡∏¥‡∏ï L8</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="swDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å</label>
                                <input type="date" id="swDate">
                            </div>
                        </div>
                        <!-- Current Stock Info -->
                        <div class="smart-withdraw-stock-info" id="swStockInfo" style="display: none;">
                            <div class="stock-info-header">üì¶ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á <span id="swStockProductName">-</span>
                            </div>
                            <div class="stock-info-grid">
                                <div class="stock-info-item">
                                    <span class="info-label">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏£‡∏ß‡∏°:</span>
                                    <span class="info-value" id="swTotalStock">0 Kg</span>
                                </div>
                                <div class="stock-info-item">
                                    <span class="info-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Lot:</span>
                                    <span class="info-value" id="swTotalLots">0 Lots</span>
                                </div>
                                <div class="stock-info-item">
                                    <span class="info-label">üì¶ ‡∏†‡∏≤‡∏ä‡∏ô‡∏∞‡∏£‡∏ß‡∏°:</span>
                                    <span class="info-value" id="swTotalContainers">-</span>
                                </div>
                                <div class="stock-info-item">
                                    <span class="info-label">Lot ‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏:</span>
                                    <span class="info-value info-warning" id="swNearExpiry">-</span>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary btn-calculate-allocation"
                            id="btnCalculateAllocation">
                            üîç ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£ Lot
                        </button>
                    </form>
                </div>

                <!-- Step 2: Preview Allocation -->
                <div class="smart-withdraw-step" id="smartWithdrawStep2" style="display: none;">
                    <h3 class="step-title">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£</h3>

                    <!-- Allocation Summary -->
                    <div class="allocation-summary" id="allocationSummary">
                        <div class="allocation-header">
                            <span class="allocation-title">üìã ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£ Lot ‡∏ï‡∏≤‡∏° FEFO/FIFO</span>
                            <span class="allocation-badge" id="allocationBadge">Auto-Allocated</span>
                        </div>
                        <div class="allocation-table-container">
                            <table class="allocation-table" id="allocationTable">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Lot No.</th>
                                        <th>‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</th>
                                        <th>Days Left</th>
                                        <th>‡∏Ç‡∏ô‡∏≤‡∏î‡∏†‡∏≤‡∏ä‡∏ô‡∏∞</th>
                                        <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏ñ‡∏±‡∏á+‡πÄ‡∏®‡∏©)</th>
                                        <th>‡∏à‡∏∞‡πÄ‡∏ö‡∏¥‡∏Å</th>
                                        <th>‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏ö‡∏¥‡∏Å (‡∏ñ‡∏±‡∏á)</th>
                                    </tr>
                                </thead>
                                <tbody id="allocationTableBody">
                                    <!-- Rows will be generated dynamically -->
                                </tbody>
                            </table>
                        </div>
                        <!-- Allocation Totals -->
                        <div class="allocation-totals">
                            <div class="total-item">
                                <span class="total-label">‡∏¢‡∏≠‡∏î‡πÄ‡∏ö‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                                <span class="total-value" id="allocationTotalQty">0 Kg</span>
                            </div>
                            <div class="total-item">
                                <span class="total-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Lot ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:</span>
                                <span class="total-value" id="allocationLotCount">0 Lots</span>
                            </div>
                        </div>
                    </div>

                    <!-- Warning Section -->
                    <div class="smart-withdraw-warning" id="swWarning" style="display: none;">
                        <span class="warning-icon">‚ö†Ô∏è</span>
                        <span class="warning-text" id="swWarningText"></span>
                    </div>

                    <!-- Action Buttons -->
                    <div class="smart-withdraw-actions">
                        <button type="button" class="btn btn-outline" id="btnBackToStep1">
                            ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        </button>
                        <button type="button" class="btn btn-success btn-confirm-withdraw" id="btnConfirmWithdraw">
                            ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
        </div>
        <span class="toast-message" id="toastMessage">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</span>
    </div>

    <!-- Stats Detail Modal -->
    <div class="modal" id="statsModal">
        <div class="modal-backdrop" onclick="closeStatsModal()"></div>
        <div class="modal-content" style="max-width: 900px; max-height: 80vh;">
            <div class="modal-header">
                <h2 id="statsModalTitle">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h2>
                <button class="modal-close" onclick="closeStatsModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="statsModalBody" style="overflow-y: auto; max-height: 60vh;">
                <!-- Content will be injected here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeStatsModal()">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <script src="app.js?v=91"></script>

    <script>
        // Integrated Module Switch Logic
        // Integrated Module Switch Logic (RENAMED to avoid conflict)
        /* Original function removed to prevent overwriting app.js switchModule */
        // function switchModule(moduleName) { ... }
        // Integrated Module Switch Logic (RENAMED to avoid conflict)

        // Renamed to avoid CONFLICT with app.js switchModule
        function switchExternalModule(moduleName) {
            const stockMain = document.getElementById('stockcard-main-view');
            const frames = {
                'consumable': document.getElementById('consumable-view-container'),
                'general': document.getElementById('general-view-container')
            };
            const tabs = {
                'package': document.getElementById('tabPackage'),
                'rm': document.getElementById('tabRM'),
                'rm_production': document.getElementById('tabRMProduction'),
                'consumable': document.getElementById('tabConsumable'),
                'general': document.getElementById('tabGeneral')
            };
            const headerActions = document.querySelector('.header-actions');

            // Hide all views first
            stockMain.style.display = 'none';
            Object.values(frames).forEach(f => { if (f) f.style.display = 'none'; });

            // Handle Tabs Class
            Object.values(tabs).forEach(t => { if (t) t.classList.remove('active'); });
            if (tabs[moduleName]) tabs[moduleName].classList.add('active');

            // Show Target Frame
            if (frames[moduleName]) {
                frames[moduleName].style.display = 'block';
                // Hide main actions
                if (headerActions) headerActions.style.display = 'none';
            }
        }


        // Hook into existing tabs (Package and RM follow internal app.js logic but need to hide iframes)
        // Hook into existing tabs (Package and RM follow internal app.js logic)
        // REMOVED duplicate listeners for Package/RM as app.js already handles them.

        // Ensure Consumable/General use the new function
        // Note: onclick attributes in HTML already set, but we need to update them or binding here.
        // Since we renamed the function, we should update the onclicks in HTML or bind here.
        // Let's bind here for safety and redundancy.
        document.getElementById('tabConsumable').onclick = () => switchExternalModule('consumable');
        document.getElementById('tabGeneral').onclick = () => switchExternalModule('general');

        // RM Production uses app.js switchModule (same as RM Center)
        document.getElementById('tabRMProduction').onclick = (e) => switchModule('rm_production', e);
    </script>

    <!-- Flatpickr Date Picker JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/th.js"></script>
    <script>
        // Initialize Flatpickr for all date inputs with DD/MM/YYYY format
        document.addEventListener('DOMContentLoaded', function () {
            // Flatpickr configuration - Thai format DD/MM/YYYY
            const flatpickrConfig = {
                dateFormat: 'd/m/Y',
                locale: 'th',
                allowInput: true,
                altInput: true,
                altFormat: 'd/m/Y',
                disableMobile: true, // Use same UI on mobile
                defaultDate: new Date(),
                onReady: function (selectedDates, dateStr, instance) {
                    // Add clear button
                    if (instance.altInput) {
                        instance.altInput.placeholder = '‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ';
                    }
                }
            };

            // Initialize all date inputs in the main page
            const dateInputIds = [
                'entryDate',      // Package modal
                'entryDateRM',    // RM Center / RM Production modal
                'entryMfgDateRM', // MFD date
                'entryExpDateRM', // EXP date
                'swDate',         // Smart Withdraw date
                'dateFilter'      // Filter date
            ];

            dateInputIds.forEach(function (id) {
                const el = document.getElementById(id);
                if (el) {
                    flatpickr(el, flatpickrConfig);
                }
            });

            console.log('[Flatpickr] Date pickers initialized with DD/MM/YYYY format');
        });

        // Helper function to initialize flatpickr on dynamically added elements
        window.initDatePicker = function (element) {
            if (element && !element._flatpickr) {
                flatpickr(element, {
                    dateFormat: 'd/m/Y',
                    locale: 'th',
                    allowInput: true,
                    altInput: true,
                    altFormat: 'd/m/Y',
                    disableMobile: true,
                    defaultDate: new Date()
                });
            }
        };
    </script>
</body>

</html>