<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบคำนวณวัสดุสิ้นเปลือง (Consumables Calculator)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css?v=mobile_fix_2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Zone Backgrounds - Removed */
        .bg-shrink {
            background-color: transparent;
        }

        .bg-fg {
            background-color: transparent;
        }

        /* Table Row Hover Override - Reset */
        table#shrink-table tbody tr:hover td.bg-shrink {
            background-color: inherit;
            color: inherit;
        }

        table#shrink-table tbody tr:hover td.bg-fg {
            background-color: inherit;
            color: inherit;
        }

        /* Status Alert - High Visibility */
        .status-badge.status-low {
            background-color: #dc2626 !important;
            /* Red-600 */
            color: white !important;
            font-weight: 700;
            box-shadow: 0 4px 6px rgba(220, 38, 38, 0.5);
            border: 2px solid #991b1b;
            padding: 4px 12px;
            border-radius: 20px;
            animation: pulse-red 2s infinite;
        }

        @keyframes pulse-red {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7);
            }

            50% {
                transform: scale(1.05);
                box-shadow: 0 0 0 6px rgba(220, 38, 38, 0);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0);
            }
        }

        @media (max-width: 768px) {
            .mobile-hidden {
                display: none !important;
            }

            /* Adjust font size for mobile table to fit */
            table#shrink-table th,
            table#shrink-table td {
                font-size: 0.75rem;
                padding: 6px 2px;
                white-space: normal;
                line-height: 1.1;
            }

            /* Adjust column widths for better proportion */
            table#shrink-table th:nth-child(2),
            table#shrink-table td:nth-child(2) {
                min-width: 120px !important;
                max-width: 160px !important;
            }

            table#shrink-table th {
                white-space: nowrap !important;
                padding: 8px 2px !important;
                font-size: 0.7rem !important;
            }

            .status-badge {
                padding: 2px 4px;
                font-size: 0.65rem;
            }

            /* Hide Group Headers on mobile */
            .header-group {
                display: none;
            }

            /* Action Buttons Visibility */
            .desktop-only {
                display: none !important;
            }

            .mobile-only {
                display: inline-flex !important;
            }
        }

        /* Default for desktop */
        .mobile-only {
            display: none;
        }

        @media (max-width: 768px) {

            /* Modal Fixes */
            .modal-content {
                width: 90% !important;
                max-width: none !important;
                margin: 20px auto !important;
                padding: 20px !important;
                max-height: 90vh;
                overflow-y: auto;
            }

            /* Stack form rows on mobile */
            .form-row {
                flex-direction: column !important;
                gap: 0 !important;
            }

            .form-group {
                width: 100% !important;
                margin-bottom: 12px;
            }

            /* Ensure inputs are easy to tap */
            input,
            select {
                font-size: 16px !important;
                /* Prevention zoom */
                padding: 10px !important;
            }

            /* Further Table Tweaks */
            table#shrink-table th {
                font-size: 0.65rem !important;
                padding: 8px 3px !important;
                /* Increased padding */
            }

            table#shrink-table td {
                font-size: 0.7rem !important;
                padding: 8px 3px !important;
                /* Increased padding */
            }

            /* Separate FG columns */
            table#shrink-table td.bg-fg,
            table#shrink-table th.highlight-head {
                padding-left: 6px !important;
                padding-right: 6px !important;
            }

            /* Last column (Actions) padding to prevent cutoff */
            table#shrink-table td:last-child,
            table#shrink-table th:last-child {
                padding-right: 10px !important;
                padding-left: 10px !important;
            }

            /* Allow actions to wrap if needed */
            .actions {
                flex-wrap: wrap;
                gap: 5px;
                justify-content: center;
            }

            .actions button {
                flex: 1 1 auto;
                /* Allow buttons to shrink/grow */
                padding: 8px 12px;
                font-size: 0.85rem;
            }

            /* Fix Transaction Type Selector shrinking on mobile */
            .trans-type-selector {
                flex-direction: column !important;
            }

            .trans-type-selector label {
                width: 100% !important;
                justify-content: flex-start !important;
                /* Align left */
                padding-left: 20px !important;
            }
        }

        /* ---------------- PRINT STYLES ---------------- */
        @media print {
            @page {
                size: A4 landscape;
                margin: 0.5cm;
            }

            body {
                visibility: visible !important;
                background: white !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                font-family: 'Sarabun', sans-serif;
            }

            /* RESET: Hide everything first */
            body * {
                visibility: hidden;
            }

            /* HIDE ALL BUTTONS & ACTIONS GLOBALLY */
            .no-print,
            .actions,
            .btn,
            .from-actions,
            .close-btn,
            #app-loader,
            #debug-panel {
                display: none !important;
            }

            /* ========================================================= 
                   MODE 1: PRINTING HISTORY (STOCK CARD)
                   Triggered by class 'printing-history-mode' on body
                   ========================================================= */
            body.printing-history-mode #history-modal {
                display: block !important;
                visibility: visible !important;
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: auto !important;
                background: white !important;
                z-index: 9999 !important;
                padding: 0 !important;
            }

            body.printing-history-mode #history-modal * {
                visibility: visible !important;
            }

            /* Show content inside modal properly */
            body.printing-history-mode .modal-content {
                width: 100% !important;
                max-width: 100% !important;
                box-shadow: none !important;
                border: none !important;
                position: static !important;
                padding: 0 10px !important;
                height: auto !important;
                overflow: visible !important;
            }

            /* Un-hide specific history elements */
            body.printing-history-mode .print-header-only,
            body.printing-history-mode .history-stats-row,
            body.printing-history-mode .table-container {
                display: block !important;
                /* or grid for stats */
            }

            body.printing-history-mode .history-stats-row {
                display: grid !important;
                /* Restore grid layout */
            }

            /* Hide Main App in History Mode */
            body.printing-history-mode .app-container {
                display: none !important;
            }

            /* Styling for History Table (Blue Theme) */
            body.printing-history-mode #history-table th {
                background-color: #4f46e5 !important;
                color: white !important;
                border: 1px solid #4f46e5 !important;
            }

            body.printing-history-mode #history-table td {
                border: 1px solid #e2e8f0 !important;
            }


            /* ========================================================= 
                   MODE 2: PRINTING INVENTORY (DEFAULT)
                   Active when body DOES NOT have 'printing-history-mode'
                   ========================================================= */
            body:not(.printing-history-mode) .app-container {
                visibility: visible !important;
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }

            body:not(.printing-history-mode) .app-container * {
                visibility: visible !important;
            }

            /* In Default Mode, HIDE ALL MODALS */
            body:not(.printing-history-mode) .modal,
            body:not(.printing-history-mode) .modal-content {
                display: none !important;
            }

            /* Hide header and stats in Default Mode */
            body:not(.printing-history-mode) header,
            body:not(.printing-history-mode) .dashboard-stats {
                display: none !important;
            }

            /* Inventory Table Styling Tweaks */
            body:not(.printing-history-mode) .table-container {
                border: none !important;
                box-shadow: none !important;
            }

            body:not(.printing-history-mode) .table-container::before {
                content: "รายการวัสดุสิ้นเปลือง (Consumables)";
                display: block;
                font-size: 14pt;
                font-weight: bold;
                margin-bottom: 6px;
                color: var(--primary-color);
                text-align: center;
            }

            body:not(.printing-history-mode) table {
                width: 100% !important;
                border-collapse: collapse !important;
                font-size: 6.5pt !important;
                /* Font Size Reduced to 6.5pt */
            }

            body:not(.printing-history-mode) tr {
                height: 22px !important;
            }

            body:not(.printing-history-mode) th,
            body:not(.printing-history-mode) td {
                padding: 1px 2px !important;
                /* Tighter padding */
                vertical-align: middle !important;
                height: 22px !important;
            }

            /* Compact Badges for Print */
            body:not(.printing-history-mode) .status-badge {
                padding: 0px 2px !important;
                font-size: 5.5pt !important;
                /* Tiny badge font */
                border-radius: 2px !important;
                line-height: 1 !important;
                display: inline-block !important;
                margin: 0 !important;
                border: 1px solid #ddd !important;
                box-shadow: none !important;
                animation: none !important;
            }

            /* Force badge text color to be readable */
            body:not(.printing-history-mode) .status-badge.status-low {
                color: #dc2626 !important;
                background-color: transparent !important;
                border-color: #dc2626 !important;
            }

            /* Prevent cells from expanding */
            body:not(.printing-history-mode) td {
                overflow: hidden;
                white-space: nowrap !important;
                text-overflow: ellipsis !important;
            }

            /* Name column: allow it to take MORE width */
            body:not(.printing-history-mode) td:nth-child(2) {
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
                max-width: 350px !important;
                /* Widen to fit long names */
            }
        }
    </style>
</head>

<body>
    <!-- Loading Overlay -->
    <div id="app-loader">
        <div class="spinner"></div>
        <div class="loader-text">กำลังเชื่อมต่อฐานข้อมูล...</div>
    </div>

    <div class="app-container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fa-solid fa-boxes-stacked"></i>
                    <div>
                        <h1>Consumables Calculate</h1>
                        <p>ระบบคำนวณการผลิตและสต็อกวัสดุสิ้นเปลือง</p>
                    </div>
                </div>
                <!-- Actions Buttons - Stacked on mobile -->
                <div class="actions">
                    <button id="add-item-btn" class="btn primary" style="white-space: nowrap;"><i
                            class="fa-solid fa-plus"></i> เพิ่มสินค้า</button>
                    <button id="refresh-data-btn" class="btn secondary" onclick="initApp()"
                        style="white-space: nowrap;"><i class="fa-solid fa-arrows-rotate"></i> รีเฟรช</button>
                    <button class="btn secondary" onclick="window.print()" style="white-space: nowrap;">
                        <i class="fa-solid fa-print"></i> พิมพ์
                    </button>
                    <button id="calc-btn" class="btn secondary"
                        style="color: #854d0e; border-color: #fcd34d; background-color: #fffbeb; white-space: nowrap;"><i
                            class="fa-solid fa-calculator"></i> คำนวณถุง</button>
                </div>
            </div>
        </header>

        <main>
            <!-- Navigation Tabs Removed -->
            <!-- Tabs nav and placeholders removed as requested -->

            <!-- Tab Content: Consumables (Current App) -->
            <div id="tab-consumables" class="tab-content active" style="display:block;">
                <div class="dashboard-stats">
                    <div class="stat-card total">
                        <div class="icon"><i class="fa-solid fa-layer-group"></i></div>
                        <div class="info">
                            <h3>รายการสินค้า</h3>
                            <span id="total-items">0</span>
                        </div>
                    </div>
                    <div class="stat-card warning">
                        <div class="icon"><i class="fa-solid fa-triangle-exclamation"></i></div>
                        <div class="info">
                            <h3>ต้องสั่งซื้อ (Low Stock)</h3>
                            <span id="low-stock-count">0</span>
                        </div>
                    </div>
                    <div class="stat-card healthy">
                        <div class="icon"><i class="fa-solid fa-check-circle"></i></div>
                        <div class="info">
                            <h3>พร้อมผลิต</h3>
                            <span id="healthy-stock-count">0</span>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <table id="shrink-table">
                        <thead>
                            <tr class="header-group">
                                <!-- Status & Name -->
                                <th colspan="2"></th>
                                <!-- Shrink Group: Stock, Kg/Box, TotalKg, Min, Pcs/Kg -->
                                <th colspan="5" class="group-shrink">ข้อมูลวัสดุสิ้นเปลือง (Consumables)</th>
                                <!-- FG Group -->
                                <th colspan="4" class="group-fg">การคำนวณสินค้าสำเร็จรูป (FG)</th>
                                <!-- Actions -->
                                <th></th>
                            </tr>
                            <th class="center" style="width: 40px;">สถานะ</th>
                            <th style="min-width: 120px;">ชื่อสินค้า</th>
                            <th class="center">คงเหลือ (ลัง)</th>
                            <th class="center text-blue">เศษ (กก.)</th>
                            <th class="center mobile-hidden">กก./ลัง (ม.)</th>
                            <th class="center">รวม (กก.)</th>
                            <th class="center mobile-hidden">จุดสั่งซื้อ (กก.)</th>
                            <th class="center mobile-hidden">ชิ้น/กก. (ม้วน)</th>
                            <th class="center mobile-hidden">ชิ้น/แพ็ค</th>
                            <th class="center mobile-hidden">ชิ้น FG/ลัง</th>

                            <!-- FG Yield -->
                            <th class="center">รวม (ชิ้น)</th>
                            <th class="center mobile-hidden">ได้ FG (ลัง)</th>
                            <th class="center mobile-hidden">Actions</th> <!-- Actions -->
                            </tr>
                        </thead>
                        <tbody id="table-body">
                            <!-- Rows will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- Edit/Add Modal -->
        <div id="item-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn" onclick="closeModal('item-modal')">&times;</span>
                <h2 id="modal-title">เพิ่ม/แก้ไข สินค้า</h2>
                <form id="item-form">
                    <input type="hidden" id="edit-index">
                    <div class="form-group">
                        <label>ชื่อสินค้า</label>
                        <input type="text" id="input-name" required placeholder="เช่น PVC Shrink film 125*185"
                            list="product-history-list" oninput="checkProductHistory(this.value)">
                        <datalist id="product-history-list"></datalist>
                    </div>

                    <div class="form-group">
                        <label>ประเภทสินค้า</label>
                        <select id="input-category" class="input-field" onchange="toggleItemFormFields()"
                            style="width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px;">
                            <option value="weight">ถุงชริ้ง (คำนวณตามน้ำหนัก กก.)</option>
                            <option value="unit">ม้วนฟิล์ม / ของชิ้น (คำนวณตามจำนวนหน่วย/ม้วน)</option>
                        </select>
                    </div>

                    <!-- SHRINK FIELDS (Category: weight) -->
                    <div id="field-shrink">
                        <h4 class="section-title">ข้อมูลวัสดุสิ้นเปลือง (ถุงชริ้ง)</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>น้ำหนักต่อลัง (kg)</label>
                                <input type="number" id="input-kg-per-carton" step="0.01" value="25">
                            </div>
                            <div class="form-group">
                                <label>จำนวนซองต่อ กก.</label>
                                <input type="number" id="input-pcs-per-kg" placeholder="เช่น 554">
                            </div>
                        </div>
                    </div>

                    <!-- ROLL FIELDS (Category: unit) -->
                    <div id="field-roll" style="display: none;">
                        <h4 class="section-title" style="color: #059669;">ข้อมูลวัสดุสิ้นเปลือง (ม้วนฟิล์ม)</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ความยาวม้วน (เมตร)</label>
                                <input type="number" id="input-roll-length" placeholder="เช่น 2664"
                                    oninput="calculateRollCapacity()">
                            </div>
                            <div class="form-group">
                                <label>ความยาวตัด/ชิ้น (มม.)</label>
                                <input type="number" id="input-cut-length" placeholder="เช่น 180"
                                    oninput="calculateRollCapacity()">
                            </div>
                        </div>
                        <div
                            style="background: #f0fdf4; padding: 10px; border-radius: 8px; border: 1px solid #bbf7d0; margin-bottom: 15px;">
                            <p style="margin: 0; font-size: 0.9em; color: #166534;">
                                <i class="fa-solid fa-calculator"></i> คำนวณอัตโนมัติ:<br>
                                <span id="roll-calc-result" style="font-weight: 600;">- ชิ้น/ม้วน</span>
                            </p>
                        </div>
                        <input type="hidden" id="input-pcs-per-roll">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="input-stock-cartons">คงเหลือปัจจุบัน (ลัง)</label>
                            <input type="number" id="input-stock-cartons" required placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="input-stock-partial" class="text-blue">เศษ (กก.)</label>
                            <input type="number" id="input-stock-partial" step="0.01" value="0" placeholder="0.00">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="input-min-threshold">แจ้งเตือนเมื่อต่ำกว่า (กก.)</label>
                            <input type="number" id="input-min-threshold" required value="100">
                        </div>
                    </div>

                    <h4 class="section-title text-blue" style="margin-top: 15px;">ข้อมูลการผลิต (FG)</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>จำนวนชิ้นงาน ต่อ 1 ถุงชริ้ง</label>
                            <input type="number" id="input-pcs-per-pack" required value="1" min="1">
                            <span class="help-text">เช่น 6 ชิ้น/แพ็ค (ถ้า 1 ต่อ 1 ให้ใส่ 1)</span>
                        </div>
                        <div class="form-group">
                            <label>จำนวนชิ้น FG ต่อลัง</label>
                            <input type="number" id="input-fg-pcs-per-carton" required placeholder="เช่น 504"
                                oninput="calculateRollCapacity()">
                        </div>
                    </div>
                    <!-- New Field for Roll Yield -->
                    <div class="form-row" id="field-roll-yield" style="display:none;">
                        <div class="form-group">
                            <label style="color: #059669; font-weight:600;">1 ม้วน ผลิตได้ (ลัง)
                                (คำนวณอัตโนมัติ)</label>
                            <input type="number" id="input-fg-yield-per-roll" step="0.01" placeholder="0.00"
                                style="background-color: #f0fdf4; border-color: #86efac; color: #166534; font-weight: 600;">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn primary">บันทึกข้อมูล</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Transaction Modal (In/Out) -->
        <div id="transaction-modal" class="modal">
            <div class="modal-content" style="max-width: 500px">
                <span class="close-btn" onclick="closeModal('transaction-modal')">&times;</span>
                <h2 id="trans-modal-title"><i class="fa-solid fa-exchange-alt"></i> บันทึกรับ/เบิก</h2>
                <form id="transaction-form">
                    <input type="hidden" id="trans-item-index">

                    <div class="form-group">
                        <label>สินค้า</label>
                        <input type="text" id="trans-item-name" readonly
                            style="background-color: #f1f5f9; border: none; font-weight: 600;">
                    </div>

                    <div class="form-group">
                        <label>ประเภทรายการ</label>
                        <div class="trans-type-selector" style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <label
                                style="flex: 1; cursor: pointer; padding: 10px; background: #dcfce7; border-radius: 8px; border: 1px solid #86efac; display: flex; align-items: center; justify-content: center; gap: 8px; color: #166534; font-weight: 600;">
                                <input type="radio" name="trans-type" value="IN" checked>
                                <span><i class="fa-solid fa-arrow-down"></i> รับของเข้า (IN)</span>
                            </label>
                            <label
                                style="flex: 1; cursor: pointer; padding: 10px; background: #fee2e2; border-radius: 8px; border: 1px solid #fca5a5; display: flex; align-items: center; justify-content: center; gap: 8px; color: #991b1b; font-weight: 600;">
                                <input type="radio" name="trans-type" value="OUT">
                                <span><i class="fa-solid fa-arrow-up"></i> เบิกของออก (OUT)</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>จำนวนเต็ม (ลัง)</label>
                            <input type="number" id="trans-qty-cartons" placeholder="0" class="large-input"
                                style="font-size: 1.2em; border-color: #3b82f6;">
                        </div>
                        <div class="form-group">
                            <label>เศษ (กิโลกรัม)</label>
                            <input type="number" id="trans-qty-partial" min="0" step="0.01" placeholder="0.00"
                                class="large-input" style="font-size: 1.2em; border-color: #3b82f6;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>วันที่</label>
                        <input type="date" id="trans-date" required>
                    </div>

                    <div class="form-group">
                        <label>เลขที่เอกสาร / Lot / หมายเหตุ</label>
                        <input type="text" id="trans-note" placeholder="เช่น PO-67001, Lot A, เบิกผลิต...">
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn primary full-width">บันทึกรายการ</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- History Modal -->
        <div id="history-modal" class="modal">
            <div class="modal-content"
                style="max-width: 900px; height: 90vh; display: flex; flex-direction: column; padding: 0;">

                <!-- Modal Header (Web View) -->
                <div class="modal-header no-print"
                    style="padding: 20px 24px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <div
                            style="background: #e0e7ff; color: var(--primary-color); width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">
                            <i class="fa-solid fa-clock-rotate-left"></i>
                        </div>
                        <div>
                            <h2 style="font-size: 1.1rem; margin: 0;">ประวัติความเคลื่อนไหว (Stock Card)</h2>
                            <p id="history-subtitle" style="margin: 0; font-size: 0.9rem; color: var(--text-muted);">
                            </p>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn secondary" onclick="printHistoryFromModal()" style="gap: 6px;">
                            <i class="fa-solid fa-print"></i> พิมพ์สต็อกการ์ด
                        </button>
                        <span class="close-btn" onclick="closeModal('history-modal')"
                            style="position: static; font-size: 1.5rem; height: 36px; width: 36px; display: flex; align-items: center; justify-content: center;">&times;</span>
                    </div>
                </div>

                <!-- PRINT ONLY HEADER -->
                <div class="print-header-only"
                    style="display: none; padding: 20px; background: #4f46e5; color: white; margin-bottom: 20px; border-radius: 8px;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <i class="fa-solid fa-box-open" style="font-size: 24px; opacity: 0.8;"></i>
                        <div>
                            <h1 id="print-product-name" style="margin: 0; font-size: 18pt;">ชื่อสินค้า...</h1>
                            <p style="margin: 4px 0 0 0; opacity: 0.9; font-size: 10pt;" id="print-print-date">
                                วันที่พิมพ์: -</p>
                        </div>
                    </div>
                </div>

                <!-- Scrollable Content -->
                <div style="flex-grow: 1; overflow-y: auto; padding: 24px;">

                    <!-- Summary Stats (Beautiful Cards) -->
                    <div class="history-stats-row"
                        style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 24px;">
                        <!-- IN -->
                        <div
                            style="background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 12px; padding: 20px; text-align: center;">
                            <p style="color: #166534; font-size: 0.9rem; font-weight: 600; margin-bottom: 8px;">
                                รับเข้าทั้งหมด</p>
                            <h3 id="hist-total-in" style="font-size: 1.8rem; color: #16a34a; margin: 0;">+0</h3>
                        </div>
                        <!-- OUT -->
                        <div
                            style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 12px; padding: 20px; text-align: center;">
                            <p style="color: #991b1b; font-size: 0.9rem; font-weight: 600; margin-bottom: 8px;">
                                เบิกออกทั้งหมด</p>
                            <h3 id="hist-total-out" style="font-size: 1.8rem; color: #dc2626; margin: 0;">-0</h3>
                        </div>
                        <!-- BALANCE -->
                        <div
                            style="background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);">
                            <p style="color: #475569; font-size: 0.9rem; font-weight: 600; margin-bottom: 8px;">
                                คงเหลือปัจจุบัน</p>
                            <h3 id="hist-current-stock" style="font-size: 1.8rem; color: #1e293b; margin: 0;">0</h3>
                        </div>
                    </div>

                    <!-- Table -->
                    <div class="table-container"
                        style="box-shadow: none; border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden;">
                        <table id="history-table">
                            <thead style="background: #4f46e5; color: white;">
                                <tr>
                                    <th style="background: #4f46e5; color: white; width: 120px;">วันที่</th>
                                    <th style="background: #4f46e5; color: white;">ประเภท</th>
                                    <th class="center" style="background: #4f46e5; color: white;">ปริมาณ (กก.)</th>
                                    <th class="center" style="background: #4f46e5; color: white;">เทียบเท่า (ลัง)</th>
                                    <th class="center" style="background: #4f46e5; color: white;">คงเหลือ (ลัง)</th>
                                    <th style="background: #4f46e5; color: white;">เอกสาร/หมายเหตุ</th>
                                    <th class="center no-print" style="width: 50px; background: #4f46e5; color: white;">
                                        ลบ</th>
                                </tr>
                            </thead>
                            <tbody id="history-body">
                                <!-- Logs go here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calculator Modal (Restored) -->
        <div id="calc-modal" class="modal">
            <div class="modal-content" style="max-width: 500px">
                <span class="close-btn" onclick="closeModal('calc-modal')">&times;</span>
                <h2 style="color: #854d0e;"><i class="fa-solid fa-calculator"></i> ทดลองคำนวณ</h2>

                <div class="form-group">
                    <label>เลือกสินค้า</label>
                    <select id="calc-select-item"
                        style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); font-family: 'Sarabun';">
                        <option value="">-- กรุณาเลือกสินค้า --</option>
                    </select>
                </div>

                <div id="calc-area"
                    style="display: none; background-color: #fffbeb; padding: 20px; border-radius: 12px; border: 1px solid #fcd34d;">
                    <div class="form-group">
                        <label style="color: #854d0e;">ระบุถุงชริ้ง (ลัง)</label>
                        <input type="number" id="modal-calc-shrink" class="calc-input"
                            style="width: 100%; text-align: left;"
                            oninput="calculateModalSimulation('shrink', this.value)">
                    </div>
                    <div class="form-group">
                        <label style="color: #854d0e;">ระบุใช้ถุง (กก.)</label>
                        <input type="number" id="modal-calc-kg" class="calc-input"
                            style="width: 100%; text-align: left;" oninput="calculateModalSimulation('kg', this.value)">
                    </div>
                    <div class="form-group">
                        <label style="color: #854d0e;">ระบุงาน (ชิ้น)</label>
                        <input type="number" id="modal-calc-pcs" class="calc-input"
                            style="width: 100%; text-align: left;"
                            oninput="calculateModalSimulation('pcs', this.value)">
                    </div>
                    <div class="form-group">
                        <label style="color: #854d0e;">ระบุงาน (ลัง)</label>
                        <input type="number" id="modal-calc-fg" class="calc-input"
                            style="width: 100%; text-align: left;" oninput="calculateModalSimulation('fg', this.value)">
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Action Sheet Modal -->
        <div id="action-sheet-modal" class="modal" style="align-items: flex-end;">
            <div class="modal-content"
                style="width: 100%; border-radius: 20px 20px 0 0; margin: 0; max-width: none; animation: slideUp 0.3s ease;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 id="action-sheet-title" style="margin: 0; font-size: 1.1rem;">จัดการสินค้า</h3>
                    <span class="close-btn" onclick="closeModal('action-sheet-modal')"
                        style="position: static;">&times;</span>
                </div>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="btn secondary" id="sheet-btn-trans"
                        style="justify-content: center; padding: 12px; font-size: 1rem;">
                        <i class="fa-solid fa-right-left"></i> ทำรายการ รับ/เบิก
                    </button>
                    <button class="btn secondary" id="sheet-btn-hist"
                        style="justify-content: center; padding: 12px; font-size: 1rem;">
                        <i class="fa-solid fa-clock-rotate-left"></i> ประวัติ
                    </button>
                    <button class="btn primary" id="sheet-btn-edit"
                        style="justify-content: center; padding: 12px; font-size: 1rem;">
                        <i class="fa-solid fa-pen"></i> แก้ไขข้อมูล
                    </button>
                    <button class="btn delete" id="sheet-btn-del"
                        style="justify-content: center; padding: 12px; font-size: 1rem;">
                        <i class="fa-solid fa-trash"></i> ลบสินค้า
                    </button>
                </div>
            </div>
        </div>

        <style>
            @keyframes slideUp {
                from {
                    transform: translateY(100%);
                }

                to {
                    transform: translateY(0);
                }
            }
        </style>


        <script src="script.js?v=mobile_fix_12"></script>
</body>

</html>